#!/bin/sh
echo "🔍 Running pre-push checks..."

# Run gitleaks to check for secrets before pushing
echo "🔐 Scanning for secrets with gitleaks..."
gitleaks protect --staged --verbose

if [ $? -ne 0 ]; then
  echo "❌ Gitleaks detected potential secrets - push rejected"
  echo "If gitleaks warns, it's probably right - fix the issue before pushing"
  exit 1
fi

echo "✅ No secrets detected"
echo "🏗️  Testing full build..."
pnpm build

if [ $? -eq 0 ]; then
  echo "✅ Build successful - push allowed"
else
  echo "❌ Build failed - push rejected"
  exit 1
fi